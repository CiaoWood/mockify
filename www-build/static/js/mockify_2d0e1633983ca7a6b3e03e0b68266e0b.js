!function(){"use strict";angular.module("mockify",["ui.router","templates","mockify.alert.controller.alert","mockify.dashboard.controller.dashboard"]).config(["$urlRouterProvider","$stateProvider",function(e,t){e.otherwise("/dashboard/targets"),t.state("app",{url:"/","abstract":!0,views:{alert:{templateUrl:"alert.html",controller:"AlertCtrl"},header:{templateUrl:"header.html"},layout:{templateUrl:"dashboard.html",controller:"DashboardCtrl"}}})}]).run(["$rootScope","$state",function(e,t){e.$on("$stateChangeSuccess",function(e,t){console.log("Current state:",t.name)}),e.$state=t}])}(),function(){"use strict";function e(e,t){return _.forEach(t,function(t,r){"_"!==r.substr(0,1)&&(r="_"+r),e[r]=t}),e}function t(e,t){var r={};return _.forIn(e,function(o,i){!_.isFunction(e[i])&&(!_.isArray(t)||_.isArray(t)&&_.contains(t,i))&&(i=i.replace(/^_/,""),r[i]=o)}),r}function r(e,t){var r=[];return _.forEach([e,t],function(e){r.push(_.map(e,function(e){return _.omit(e,function(e,t){return/^\$+/.test(t)})}))}),_.isEqual(r[0],r[1])}_.mixin({privateMerge:e,publicProperties:t,isAlmostEqual:r})}(),function(){"use strict";angular.module("mockify.alert.controller.alert",["mockify.common.service.webSocket"]).controller("AlertCtrl",["$rootScope","$scope","$interval","webSocketService",function(e,t,r,o){t.restartLoopHideAlertId,t.showAlert=!1;var i=function(){r.cancel(t.restartLoopHideAlertId),t.restartLoopHideAlertId=r(function(){t.hideAlert()},1e4)},n=function(e){t.type=e.type||"danger",t.strong=e.strong,t.message=e.message,t.showAlert=!0,i()};o.on("alert",function(e){t.$apply(function(){n(e)})}),e.$on("alert",function(e,t){n(t)}),e.$on("hideAlert",function(){t.showAlert=!1}),e.alertError=function(t){_.isString(t)&&(t={message:t}),e.$broadcast("alert",t)},e.alertInfo=function(t){_.isString(t)&&(t={message:t}),t.type="info",e.$broadcast("alert",t)},e.hideAlert=function(){e.$broadcast("hideAlert")}}])}(),function(){"use strict";angular.module("mockify.common.service.config",[]).factory("configFactory",["$window",function(e){return e.config}])}(),function(){"use strict";angular.module("mockify.common.service.localStorage",[]).service("localStorageService",["$window",function(e){var t=e.localStorage;this.get=function(e,r){r=r||10;var o=[],i=_.has(t,e)&&JSON.parse(t[e]);if(_.isArray(i)){var n=i.length-r;0>n&&(n=0),o=i.slice(n)}return o},this.last=function(e){var r;return _.has(t,e)&&_.isArray(r=JSON.parse(t[e]))&&_.last(r)},this.push=function(e,t){var r=this.get(e);_.isArray(r)?(r.push(t),this.save(e,_.uniq(r))):this.save(e,[t])},this.save=function(e,r){t[e]=JSON.stringify(r)},this["delete"]=function(e){delete t[e]},this.deleteValue=function(e,t){var r=this.get(e);_.isArray(r)&&this.save(e,_.pull(r,t))}}])}(),function(){"use strict";angular.module("mockify.common.service.webSocket",["mockify.common.service.config"]).factory("webSocketService",["$rootScope","$interval","configFactory",function(e,t,r){var o=io("http://localhost:"+r.websocket.port);return t(function(){o.connected||e.alertError("Websocket server has gone away!")},1e4),{on:function(e,t){o.on(e,function(e){t(e)})},emit:function(e,t){o.emit(e,t)}}}])}(),function(){"use strict";angular.module("mockify.dashboard.controller.dashboard",["mockify.target.controller.target","mockify.record.controller.record","mockify.response.controller.response","mockify.log.controller.log","mockify.dashboard.service.searchHistory"]).config(["$stateProvider",function(e){e.state("app.dashboard",{url:"dashboard","abstract":!0,views:{"navContainer@app":{templateUrl:"nav.html"},"logsContainer@app":{templateUrl:"logs.html",controller:"LogsCtrl"}}})}]).controller("DashboardCtrl",["$scope","$state","localStorageService","searchHistoryFactory",function(e,t,r,o){void 0===e.responses&&(e.responses=r.get("responses")),e.search={value:""},e.searchObjects={},e.getSearchObject=function(t){var r=t||e.$state.$current.name,i=r.split(/\./).slice(0,3).pop();return e.searchObjects[i]||(e.searchObjects[i]=o["new"]()),e.searchObjects[i]},e.updateSearchValue=function(){e.getSearchObject().value(e.search.value)},e.clearSearch=function(){e.search.value="",e.updateSearchValue()},e.filterObjects=function(t){try{var r=e.getSearchObject().eval_(_.publicProperties(t));return e.search.error=!1,r}catch(o){return e.search.error=!0,!1}}}])}(),function(){"use strict";angular.module("mockify.dashboard.directive.setToSearchBox",[]).directive("setToSearchBox",[function(){return{restrict:"A",controller:["$scope",function(e){e.click=function(t){e.$apply(function(){e.search.value=t,e.updateSearchValue()})}}],link:function(e,t,r){t.on("click",function(){var o=r.setToSearchBox,i=t.html().trim()||t.attr("title").trim();_.isString(i)&&(i="'"+i+"'"),e.click(o+"=="+i)})}}}])}(),function(){"use strict";angular.module("mockify.dashboard.directive.submitOnCtrlEnter",[]).directive("submitOnCtrlEnter",[function(){return{restrict:"A",link:function(e,t){t.on("keydown",function(e){13===e.keyCode&&e.ctrlKey&&t.find("[type=submit]").eq(0).click()})}}}])}(),function(){"use strict";angular.module("mockify.dashboard.service.searchHistory",[]).factory("searchHistoryFactory",["$rootScope",function(e){var t=function(){this._value=null,this.value=function(e){return angular.isDefined(e)&&(this._value=e),this._value},this.eval_=function(t){var r=this._value||"true";return e.$eval(r,t)}};return{"new":function(){return new t}}}])}(),function(){"use strict";angular.module("mockify.log.controller.log",["mockify.common.service.webSocket","mockify.log.directive.updateScroll","perfect_scrollbar"]).controller("LogsCtrl",["$scope","webSocketService",function(e,t){e.logs=[],_.forEach(["proxy","mock"],function(r){t.on(r+"Out",function(t){e.$apply(function(){e.logs.push(t)})}),t.on(r+"Error",function(t){e.$apply(function(){e.logs.push(t)})})})}])}(),function(){"use strict";angular.module("mockify.log.directive.updateScroll",[]).directive("updateScroll",[function(){return{restrict:"A",link:function(e,t){var r=t;e.$watch("logs",function(){r.animate({scrollTop:r.prop("scrollHeight")},500)},!0)}}}])}(),function(){"use strict";angular.module("mockify.record.controller.record",["truncate","mockify.common.service.webSocket","mockify.record.entity.record","mockify.dashboard.directive.setToSearchBox","mockify.dashboard.directive.submitOnCtrlEnter"]).config(["$stateProvider",function(e){e.state("app.dashboard.records",{url:"/records",views:{"primaryContainer@app":{templateUrl:"records.html",controller:"RecordCtrl"}}}).state("app.dashboard.records.edit",{url:"/:id/edit",views:{recordEdition:{templateUrl:"record-edition.html",controller:"RecordEditionCtrl"}}}).state("app.dashboard.records.add",{url:"/add",views:{"primaryContainer@app":{templateUrl:"record-addition.html",controller:"RecordAdditionCtrl"}}})}]).controller("RecordCtrl",["$scope","$state","webSocketService","recordFactory",function(e,t,r,o){e.search.value=e.getSearchObject().value();var i=function(r){var i=_.map(r.records,function(e){return new o(e)});e.$apply(function(){if(e.records=i,_.has(t.params,"id")){var r=parseInt(t.params.id),o=_(e.records).where({_id:r}).first(),n=_.findIndex(e.records,{_id:r});angular.isDefined(o)&&angular.isDefined(n)&&e.toggleRecordDetails(o,n)}})};r.emit("listRecords"),r.on("listRecords",i),e.listRecords=function(){r.emit("listRecords")};var n=["_body","_reqHeaders","_resHeaders","_parameters"],c=["_id","_uuid","_targetId","opened","index"],s=["_dateCreated"];e.toggleRecordDetails=function(r,o){if(r.opened=!r.opened,r.index=o,r.opened){var i=_.cloneDeep(r),a=_.without.apply(this,[].concat([_.keys(i)],c)),l=[];_.forEach(a,function(e){var t={key:e,value:function(e){var t=e;return _.isObject(e)&&(t=JSON.stringify(e,null,2)),t}(i[e]),isJson:_.contains(n,e),isReadOnly:_.contains(s,e)};l.push(t)}),i.details=l,e.records.splice(r.index+1,0,i),t.go("app.dashboard.records.edit",{id:r._id})}else e.records.splice(r.index+1,1),t.go("app.dashboard.records")},e.removeRecord=function(e){r.emit("removeRecord",e)}}]).controller("RecordEditionCtrl",["$scope","webSocketService",function(e,t){e.validRecordEdition=function(r,o){var i=!1;if(_.forEach(r.details,function(t){if(t.isJson)try{JSON.parse(t.value)}catch(r){i=!0,e.alertError("The value of the "+t.key+" property in not a valid JSON structure.")}}),!i){o--;var n=_.reduce(r.details,function(e,t){return e[t.key]=t.value,e},{});n.id=r._id,t.emit("updateRecord",_.publicProperties(n)),t.on("updateRecord",function(t){e.alertInfo(t),e.listRecords()}),e.toggleRecordDetails(e.records[o],o)}}}])}(),function(){"use strict";angular.module("mockify.record.entity.record",[]).factory("recordFactory",[function(){var e=function(e){_.privateMerge(this,e)};return e.prototype.body=function(){return this._body&&JSON.stringify(this._body)||"-"},e}])}(),function(){"use strict";angular.module("mockify.response.controller.response",["mockify.common.service.webSocket","mockify.record.entity.record","mockify.response.entity.response","mockify.common.service.localStorage"]).config(["$stateProvider",function(e){e.state("app.dashboard.responses",{url:"/responses",views:{"primaryContainer@app":{templateUrl:"responses.html",controller:"ResponseCtrl"}}})}]).controller("ResponseCtrl",["$scope","$state","webSocketService","proxyResponseFactory","mockResponseFactory","localStorageService",function(e,t,r,o,i,n){e.search.value=e.getSearchObject().value();var c="responses";e.openRecordEdition=function(e){t.go("app.dashboard.records.edit",{id:e})},e.clearHistory=function(){n["delete"](c),e.responses.length=0},_.forEach(["proxy","mock"],function(t){r.on(t+"Response",function(t){var r=t;"proxy"===t.source&&(r=new o(t.message)),"mock"===t.source&&(r=new i(t.message)),e.$apply(function(){e.responses.push(r);var t=_.max([0,e.responses.length-10]);n.save(c,e.responses.slice(t))})})})}])}(),function(){"use strict";angular.module("mockify.response.entity.response",[]).factory("proxyResponseFactory",[function(){var e=function(e){if(this._source="proxy",this._status=this._method=this._host=this._url=this._targetHost,_.isObject(e))_.privateMerge(this,e);else if(_.isString(e)){var t=e.split(";");this._status=t[0],this._method=t[1],this._host=t[2],this._url=t[3],this._targetHost=t[4]}};return e}]).factory("mockResponseFactory",[function(){var e=function(e){if(this._source="mock",this._status=this._method=this._host=this._url,_.isObject(e))_.privateMerge(this,e);else if(_.isString(e)){var t=e.split(";");this._status=t[0],this._method=t[1],this._host=t[2],this._url=t[3],this._recordId=parseInt(t[4].trim())}};return e}])}(),function(){"use strict";angular.module("mockify.target.controller.target",["mockify.common.service.webSocket","mockify.common.service.localStorage","mockify.target.entity.target","toggle-switch"]).config(["$stateProvider",function(e){e.state("app.dashboard.targets",{url:"/targets",views:{"primaryContainer@app":{templateUrl:"targets.html",controller:"TargetCtrl"}}})}]).controller("TargetCtrl",["$scope","$interval","webSocketService","localStorageService","targetFactory",function(e,t,r,o,i){var n=function(){return e.targetsStored=o.get("urls",10),o.last("urls")||"http://jsonplaceholder.typicode.com"};e.targetList=[],e.defaultValues={url:n(),port:4e3},e.addAndStartTarget=function(t,r){t=t||e.defaultValues.port,r=r||e.defaultValues.url,o.push("urls",r);var c=new i({port:t,url:r,proxying:0,mocking:0,enabled:0});c.add(),e.targetsList.push(c),delete e.target,delete e.port,e.defaultValues.target=n()},e.removeTarget=function(e){e.hidden=!0,e.remove()},e.toggleRecordTarget=function(e){e.toggleRecording()},e.toggleMockTarget=function(e){e.toggleMock()},e.toggleEnableTarget=function(e){e.toggleEnable()},e.removeEntry=function(){e.url&&(o.deleteValue("urls",e.url),e.url=null,e.targetsStored=o.get("urls",10))},r.on("listTargets",function(t){var r=_.map(t.targets,function(e){return new i(e)}),o=!_.isAlmostEqual(e.targetsList,r);(void 0===e.targetsList||o)&&e.$apply(function(){e.targetsList=r})})}])}(),function(){"use strict";angular.module("mockify.target.entity.target",["mockify.common.service.webSocket"]).factory("targetFactory",["webSocketService",function(e){var t=function(e){this.hidden=!1,this._id=this._port=this._url=this._recording=this._proxying=this._mocking=this._enabled,_.privateMerge(this,e)};return t.prototype.id=function(){return this._id},t.prototype.port=function(){return this._port},t.prototype.url=function(){return this._url},t.prototype.recording=function(){return this._recording},t.prototype.proxying=function(){return this._proxying},t.prototype.mocking=function(){return this._mocking},t.prototype.enabled=function(){return this._enabled},t.prototype.add=function(){e.emit("addTarget",_.publicProperties(this,["_port","_url"]))},t.prototype.remove=function(){e.emit("removeTarget",_.publicProperties(this))},t.prototype.toggleRecording=function(){this._recording=!this._recording,e.emit("recordingTarget",{targetProperties:{id:this._id},status:this._recording})},t.prototype.toggleMock=function(){var t=this._mocking?"startMock":"startProxy";e.emit(t,_.publicProperties(this))},t.prototype.toggleEnable=function(){var t=this._enabled?"enableTarget":"disableTarget";e.emit(t,{id:this._id})},t.prototype.mock=function(){e.emit("mockTarget",_.publicProperties(this))},t}])}();