!function(){"use strict";angular.module("mockify.alert",["mockify.service.webSocket"]).controller("AlertCtrl",["$rootScope","$scope","$interval","webSocketService",function(t,e,r,o){e.restartLoopHideAlertId,e.showAlert=!1;var n=function(){r.cancel(e.restartLoopHideAlertId),e.restartLoopHideAlertId=r(function(){e.hideAlert()},1e4)},i=function(t){e.type=t.type||"danger",e.strong=t.strong,e.message=t.message,e.showAlert=!0,n()};o.on("alert",function(t){e.$apply(function(){i(t)})}),t.$on("alert",function(t,e){i(e)}),t.$on("hideAlert",function(){e.showAlert=!1}),t.alertError=function(e){_.isString(e)&&(e={message:e}),t.$broadcast("alert",e)},t.alertInfo=function(e){_.isString(e)&&(e={message:e}),e.type="info",t.$broadcast("alert",e)},t.hideAlert=function(){t.$broadcast("hideAlert")}}])}(),function(){"use strict";angular.module("mockify",["ui.router","ui.bootstrap","templates","mockify.alert","mockify.dashboard"]).config(["$urlRouterProvider","$stateProvider",function(t,e){t.otherwise("/dashboard/responses"),e.state("app",{url:"/",views:{alert:{templateUrl:"alert.html",controller:"AlertCtrl"},header:{templateUrl:"header.html"},layout:{templateUrl:"2columns.html"}}})}]).run(["$rootScope","$state",function(t,e){t.$on("$stateChangeSuccess",function(t,e){console.log("Current state:",e.name)}),t.$on("$stateChangeStart",function(t,r){"app"===r.name&&e.go("app.dashboard")}),t.$state=e}])}(),function(){"use strict";angular.module("mockify.service.config",[]).factory("configFactory",["$window",function(t){return t.config}])}(),function(){"use strict";angular.module("mockify.dashboard",["mockify.process","mockify.leftPanel","mockify.logs"]).config(["$urlRouterProvider","$stateProvider",function(t,e){e.state("app.dashboard",{url:"dashboard",views:{primaryContainer:{templateUrl:"left-panel.html",controller:"LeftPanelCtrl"},secondaryContainer:{templateUrl:"targets.html",controller:"TargetCtrl"},logsContainer:{templateUrl:"logs.html",controller:"LogsCtrl"}}})}])}(),function(){"use strict";angular.module("mockify.leftPanel",["mockify.service.webSocket","mockify.entity.response","mockify.entity.record","truncate"]).config(["$urlRouterProvider","$stateProvider",function(t,e){e.state("app.dashboard.responses",{url:"/responses",views:{"tabContent@app.dashboard":{templateUrl:"responses.html",controller:"ResponsesCtrl"}}}).state("app.dashboard.records",{url:"/records",views:{"tabContent@app.dashboard":{templateUrl:"records.html",controller:"RecordsCtrl"}}})}]).controller("LeftPanelCtrl",["$scope","$state",function(t,e){void 0===t.logs&&(t.logs=[]),t.search={value:void 0},t.selectTab=function(t){e.go(t,{})}}]).controller("ResponsesCtrl",["$scope","webSocketService","proxyResponseFactory",function(t,e,r){_.forEach(["proxy","mock"],function(o){e.on(o+"Response",function(e){var o=e;"proxy"===e.source&&(o=new r(e.message)),t.$apply(function(){t.logs.push(o)})})})}]).controller("RecordsCtrl",["$scope","webSocketService","recordFactory",function(t,e,r){var o=function(e){var o=_.map(e.records,function(t){return new r(t)});t.$apply(function(){t.records=o})};e.emit("listRecords"),e.on("listRecords",o),t.listRecords=function(){e.emit("listRecords")},t.toggleRecordDetails=function(e,r){if(e.opened=!e.opened,e.index=r,e.opened){var o=_.cloneDeep(e),n=["_body","_reqHeaders","_resHeaders","_parameters"];delete o.opened,delete o.index,o.details={keys:_.keys(o),values:_.map(_.values(o),function(t){var e=t;return _.isObject(t)&&(e=JSON.stringify(t,null,2)),e}),jsonValues:_.map(_.keys(o),function(t){return _.contains(n,t)})},t.records.splice(e.index+1,0,o)}else t.records.splice(e.index+1,1)},t.removeRecord=function(t){e.emit("removeRecord",t)},t.validRecordEdition=function(r,o){var n=!1;if(_.map(r.details.keys,function(e,o){if(r.details.jsonValues[o])try{JSON.parse(r.details.values[o])}catch(i){n=!0,t.alertError("The value of the "+e+" property in not a valid JSON structure.")}}),!n){o--;var i={};_.map(r.details.keys,function(t,e){i[t]=r.details.values[e]}),e.emit("updateRecord",_.publicProperties(i)),e.on("updateRecord",function(e){t.alertInfo(e),t.listRecords()}),t.toggleRecordDetails(t.records[o],o)}}}]).directive("setToSearchBox",[function(){return{restrict:"A",controller:["$scope",function(t){t.click=function(e){t.$apply(function(){t.search.value=e})}}],link:function(t,e){e.on("click",function(){t.click(angular.element(this).html())})}}}])}(),function(){"use strict";angular.module("mockify.service.localStorage",[]).factory("localStorageFactory",["$window",function(t){var e=t.localStorage;return{get:function(t,r){r=r||10;var o=[],n=_.has(e,t)&&JSON.parse(e[t]);if(_.isArray(n)){var i=n.length-r;0>i&&(i=0),o=n.slice(i)}return o},last:function(t){var r;return _.has(e,t)&&_.isArray(r=JSON.parse(e[t]))&&_.last(r)},push:function(t,e){var r=this.get(t);_.isArray(r)?(r.push(e),this.save(t,_.uniq(r))):this.save(t,[e])},save:function(t,r){e[t]=JSON.stringify(r)},"delete":function(t){delete e[t]}}}])}(),function(){"use strict";function t(t,e){return _.forEach(e,function(e,r){"_"!==r.substr(0,1)&&(r="_"+r),t[r]=e}),t}function e(t,e){var r={};return _.forIn(t,function(o,n){!_.isFunction(t[n])&&(!_.isArray(e)||_.isArray(e)&&_.contains(e,n))&&(n=n.replace(/^_/,""),r[n]=o)}),r}function r(t,e){var r=[];return _.forEach([t,e],function(t){r.push(_.map(t,function(t){return _.omit(t,function(t,e){return/^\$+/.test(e)})}))}),_.isEqual(r[0],r[1])}_.str.include("Underscore.string","string"),_.mixin({privateMerge:t,publicProperties:e,isAlmostEqual:r})}(),function(){"use strict";angular.module("mockify.logs",["mockify.service.webSocket","mockify.logs.directives","perfect_scrollbar"]).controller("LogsCtrl",["$scope","webSocketService",function(t,e){t.logs=[],_.forEach(["proxy","mock"],function(r){e.on(r+"Out",function(e){t.$apply(function(){t.logs.push(e)})}),e.on(r+"Error",function(e){t.$apply(function(){t.logs.push(e)})})})}])}(),function(){"use strict";angular.module("mockify.logs.directives",[]).directive("updateScroll",[function(){return{restrict:"A",link:function(t,e){var r=e;t.$watch("logs",function(){r.animate({scrollTop:r.prop("scrollHeight")},500)},!0)}}}])}(),function(){"use strict";angular.module("mockify.entity.record",[]).factory("recordFactory",[function(){var t=function(t){_.privateMerge(this,t)};return t.prototype.body=function(){return this._body&&JSON.stringify(this._body)||"-"},t}])}(),function(){"use strict";angular.module("mockify.entity.response",[]).factory("proxyResponseFactory",[function(){var t=function(t){if(this._source="proxy",this._status=this._host=this._url=this._targetHost,_.isObject(t))_.privateMerge(this,t);else if(_.isString(t)){var e=t.split(";");this._status=e[0],this._host=e[1],this._url=e[2],this._targetHost=e[3]}};return t}])}(),function(){"use strict";angular.module("mockify.service.webSocket",["mockify.service.config"]).factory("webSocketService",["$rootScope","$interval","configFactory",function(t,e,r){var o=io("http://localhost:"+r.websocket.port);return e(function(){o.connected||t.alertError("Websocket server has gone away!")},1e4),{on:function(t,e){o.on(t,function(t){e(t)})},emit:function(t,e){o.emit(t,e)}}}])}(),function(){"use strict";angular.module("mockify.process",["mockify.service.webSocket","mockify.service.localStorage","mockify.entity.target","toggle-switch"]).controller("TargetCtrl",["$scope","$interval","webSocketService","localStorageFactory","targetFactory",function(t,e,r,o,n){var i=function(){return t.targetsStored=o.get("targets",10),o.last("targets")||"http://jsonplaceholder.typicode.com"};t.targetList=[],t.defaultValues={url:i(),port:4e3},t.addAndStartTarget=function(e,r){e=e||t.defaultValues.port,r=r||t.defaultValues.url,o.push("urls",r);var c=new n({port:e,url:r,proxying:0,mocking:0,enabled:0});c.add(),t.targetsList.push(c),delete t.target,delete t.port,t.defaultValues.target=i()},t.removeTarget=function(t){t.hidden=!0,t.remove()},t.toggleRecordTarget=function(t){t.toggleRecording()},t.toggleMockTarget=function(t){t.toggleMock()},t.toggleEnableTarget=function(t){t.toggleEnable()},r.on("listTargets",function(e){var r=_.map(e.targets,function(t){return new n(t)}),o=!_.isAlmostEqual(t.targetsList,r);(void 0===t.targetsList||o)&&t.$apply(function(){t.targetsList=r})})}])}(),function(){"use strict";angular.module("mockify.entity.target",["mockify.service.webSocket"]).factory("targetFactory",["webSocketService",function(t){var e=function(t){this.hidden=!1,this._id=this._port=this._url=this._recording=this._proxying=this._mocking=this._enabled,_.privateMerge(this,t)};return e.prototype.id=function(){return this._id},e.prototype.port=function(){return this._port},e.prototype.url=function(){return this._url},e.prototype.recording=function(){return this._recording},e.prototype.proxying=function(){return this._proxying},e.prototype.mocking=function(){return this._mocking},e.prototype.enabled=function(){return this._enabled},e.prototype.add=function(){t.emit("addTarget",_.publicProperties(this,["_port","_url"]))},e.prototype.remove=function(){t.emit("removeTarget",_.publicProperties(this))},e.prototype.toggleRecording=function(){this._recording=!this._recording,t.emit("recordingTarget",{targetProperties:{id:this._id},status:this._recording})},e.prototype.toggleMock=function(){var e=this._mocking?"startMock":"startProxy";t.emit(e,_.publicProperties(this))},e.prototype.toggleEnable=function(){var e=this._enabled?"enableTarget":"disableTarget";t.emit(e,{id:this._id})},e.prototype.mock=function(){t.emit("mockTarget",_.publicProperties(this))},e}])}();